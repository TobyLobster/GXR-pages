<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>Chapter 19: Rectangle copy and move</title>
<link href="../docs-assets/Breadcrumbs.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Breadcrumbs.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Carousel.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Navigation.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Base.css" rel="stylesheet" rev="stylesheet" type="text/css">
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">

<link href="../docs-assets/Contents.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Progress.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Fonts.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Popups.css" rel="stylesheet" rev="stylesheet" type="text/css">
<script>
function togglePopup(material_id) {
  var popup = document.getElementById(material_id);
  popup.classList.toggle("show");
}
</script>

<link href="../docs-assets/Colours.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/ACME-Colours.css" rel="stylesheet" rev="stylesheet" type="text/css">
		
	</head>
	<body class="commentary-font">
		<nav role="navigation">
		<p>BBC Computer 32K</p>
<h1>*GXR</h1>
<ul><li><a href="../index.html">&#x21A9; home</a></li><li><a href="index.html"><span class="selectedlink">contents</span></a></li>
<li><a href="S-s1.html">introduction</a></li>
<li><a href="S-s2.html">constants</a></li>
<li><a href="S-s3.html">memory addresses</a></li>
<li><a href="S-s4.html"><b>$8000</b>: chapter 4</a></li>
<li><a href="S-s5.html"><b>$8167</b>: chapter 5</a></li>
<li><a href="S-s6.html"><b>$82a9</b>: chapter 6</a></li>
<li><a href="S-s7.html"><b>$8349</b>: chapter 7</a></li>
<li><a href="S-s8.html"><b>$88f9</b>: chapter 8</a></li>
<li><a href="S-s9.html"><b>$8955</b>: chapter 9</a></li>
<li><a href="S-s10.html"><b>$899d</b>: chapter 10</a></li>
<li><a href="S-s11.html"><b>$8a8a</b>: chapter 11</a></li>
<li><a href="S-s12.html"><b>$8bb4</b>: chapter 12</a></li>
<li><a href="S-s13.html"><b>$8d83</b>: chapter 13</a></li>
<li><a href="S-s14.html"><b>$8dd2</b>: chapter 14</a></li>
<li><a href="S-s15.html"><b>$8e5b</b>: chapter 15</a></li>
<li><a href="S-s16.html"><b>$9044</b>: chapter 16</a></li>
<li><a href="S-s17.html"><b>$9872</b>: chapter 17</a></li>
<li><a href="S-s18.html"><b>$9ced</b>: chapter 18</a></li>
<li><span class="unlink"><b>$9f7c</b>: chapter 19</span></li>
<li><a href="S-s20.html"><b>$a258</b>: chapter 20</a></li>
<li><a href="S-s21.html"><b>$a40e</b>: chapter 21</a></li>
<li><a href="S-s22.html"><b>$a808</b>: chapter 22</a></li>
<li><a href="S-s23.html"><b>$b9ea</b>: chapter 23</a></li>
<li><a href="S-s24.html"><b>$bdd0</b>: chapter 24</a></li>
<li><a href="S-s25.html"><b>$bfdb</b>: chapter 25</a></li>

</ul>
		</nav>
		<main role="main">
		<!--Weave of 'Chapter 19: Rectangle copy and move' generated by Inweb-->
<div class="breadcrumbs">
    <ul class="crumbs"><li><a href="../index.html">Home</a></li><li><a href="index.html">GXR</a></li><li><b>Chapter 19: Rectangle copy and move</b></li></ul></div>
<p class="purpose">Moves a rectangluar area of the screen around - 732 bytes (4.4%)</p>

<ul class="toc"><li><a href="S-s19.html#SP1">&#167;1. Moving a rectangle</a></li><li><a href="S-s19.html#SP2">&#167;2. Check coordinate of a point is in the window bounds vertically</a></li><li><a href="S-s19.html#SP3">&#167;3. Check coordinate of a point is in the window bounds (horizontal or vertical)</a></li><li><a href="S-s19.html#SP4">&#167;4. blockCopyOrMoveScreenRectangle</a></li><li><a href="S-s19.html#SP5">&#167;5. Copy a rectangle of pixels on-screen to a destination on screen</a></li><li><a href="S-s19.html#SP6">&#167;6. Helper for rectangle copy (increment and compare)</a></li><li><a href="S-s19.html#SP7">&#167;7. Helper for rectangle copy (decrement and compare)</a></li><li><a href="S-s19.html#SP8">&#167;8. Add two points and subtract a third</a></li><li><a href="S-s19.html#SP9">&#167;9. Add two coordinates and subtract a third</a></li><li><a href="S-s19.html#SP10">&#167;10. Prepare masks ready for the rectangle copy, and return the width in bytes.</a></li></ul><hr class="tocbar">

<p class="commentary firstcommentary"><a id="SP1" class="paragraph-anchor"></a><b>&#167;1. Moving a rectangle. </b></p>

<p class="center-p"><img src="rect_move.png" alt="rect_move.png"></p>

<p class="commentary firstcommentary"><a id="SP2" class="paragraph-anchor"></a><b>&#167;2. Check coordinate of a point is in the window bounds vertically. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       X is the offset to the coordinate to check</span>
<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">       .vduTempStoreDA is the error code:</span>
<span class="ACME-plain-syntax">           0 = no error</span>
<span class="ACME-plain-syntax">           1 = first check failed</span>
<span class="ACME-plain-syntax">           2 = second check failed</span>
<span class="ACME-plain-syntax">       Zero flag set if no error</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">checkPointIsWithinBoundsVertically</span><button class="popup" onclick="togglePopup('usagePopup1')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup1">Usage of <span class="code-font"><span class="ACME-function-syntax">checkPointIsWithinBoundsVertically</span></span>:<br/><a href="S-s19.html#SP5">&#167;5</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $9f7c</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #2                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP3" class="paragraph-anchor"></a><b>&#167;3. Check coordinate of a point is in the window bounds (horizontal or vertical). </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">       X is the offset to the coordinate to check</span>
<span class="ACME-plain-syntax">       Y is the offset to the second variable to check (0 for horizontal or 2 for vertical)</span>
<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">       A=.vduTempStoreDA is the error code (0 = no error, 1 = first check failed, 2 = second check failed)</span>
<span class="ACME-plain-syntax">       Zero flag set if no error</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">checkPointIsWithinBounds</span><button class="popup" onclick="togglePopup('usagePopup2')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup2">Usage of <span class="code-font"><span class="ACME-function-syntax">checkPointIsWithinBounds</span></span>:<br/><a href="S-s19.html#SP5">&#167;5</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $9f7e</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #0                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP8" class="function-link"><span class="ACME-function-syntax">checkPointIsWithinWindowHorizontalOrVertical</span></a><span class="ACME-plain-syntax">   </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INX</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INX</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP4" class="paragraph-anchor"></a><b>&#167;4. blockCopyOrMoveScreenRectangle. </b></p>

<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">blockCopyOrMoveScreenRectangle</span><button class="popup" onclick="togglePopup('usagePopup3')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup3">Usage of <span class="code-font"><span class="ACME-function-syntax">blockCopyOrMoveScreenRectangle</span></span>:<br/>Chapter 11: Shared PLOT subroutines and tables - <a href="S-s11.html#SP8">&#167;8</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $9f8c</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vdu25ParameterPlotType</span></a><span class="ACME-plain-syntax">                         </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP5" class="function-link"><span class="ACME-function-syntax">blockCopyOrMoveScreenRectangleInternal</span></a><span class="ACME-plain-syntax">         </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s12.html#SP4" class="function-link"><span class="ACME-function-syntax">setGraphicsCursorPositionAndFinishPLOT</span></a><span class="ACME-plain-syntax">         </span>
</pre>
<p class="commentary firstcommentary"><a id="SP5" class="paragraph-anchor"></a><b>&#167;5. Copy a rectangle of pixels on-screen to a destination on screen. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Optionally fill the source rectangle the current graphics background colour ('Move').</span>

<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">   A: Holds the plot type:</span>
<span class="ACME-plain-syntax">     $B8 (184) Move only       relative</span>
<span class="ACME-plain-syntax">     $B9 (185) Move rectangle  relative</span>
<span class="ACME-plain-syntax">     $BA (186) Copy rectangle  relative</span>
<span class="ACME-plain-syntax">     $BB (187) Copy rectangle  relative</span>
<span class="ACME-plain-syntax">     $BC (188) Move only       absolute</span>
<span class="ACME-plain-syntax">     $BD (189) Move rectangle  absolute</span>
<span class="ACME-plain-syntax">     $BE (190) Copy rectangle  absolute</span>
<span class="ACME-plain-syntax">     $BF (191) Copy rectangle  absolute</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">blockCopyOrMoveScreenRectangleInternal</span><button class="popup" onclick="togglePopup('usagePopup4')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup4">Usage of <span class="code-font"><span class="ACME-function-syntax">blockCopyOrMoveScreenRectangleInternal</span></span>:<br/><a href="S-s19.html#SP4">&#167;4</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $9f95</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> #2                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">rectCopyPlotType</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">0=Move, 2=Copy</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Set up gcol mask bytes from the plot options table</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP8" class="function-link"><span class="ACME-function-syntax">gcolPlotOptionsTable</span></a><span class="ACME-plain-syntax">                           </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP1" class="function-link"><span class="ACME-function-syntax">gcolModeMask0</span></a><span class="ACME-plain-syntax">                                  </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP8" class="function-link"><span class="ACME-function-syntax">gcolPlotOptionsTable</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">                       </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP1" class="function-link"><span class="ACME-function-syntax">gcolModeMask1</span></a><span class="ACME-plain-syntax">                                  </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP8" class="function-link"><span class="ACME-function-syntax">gcolPlotOptionsTable</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">                       </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP1" class="function-link"><span class="ACME-function-syntax">gcolModeMask2</span></a><span class="ACME-plain-syntax">                                  </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP8" class="function-link"><span class="ACME-function-syntax">gcolPlotOptionsTable</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">4</span><span class="ACME-plain-syntax">                       </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP1" class="function-link"><span class="ACME-function-syntax">gcolModeMask3</span></a><span class="ACME-plain-syntax">                                  </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Set background colour / pattern</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #1                                              </span><span class="ACME-comment-syntax">X = 1 for background</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP5" class="function-link"><span class="ACME-function-syntax">setupCurrentPattern</span></a><span class="ACME-plain-syntax">                            </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Copy background pattern into fill pattern</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #7                                              </span><span class="ACME-comment-syntax">loop counter</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">gxrCurrentPattern</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">fillPattern</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">copy current pattern into fillPattern</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">for 8 bytes</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (not done yet) then branch (loop</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">back)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Sort graphics cursor point and old point (the source rectangle coordinates)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">so we have bottom left and top right points</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduOldGraphicsCursorPixelsXLow</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax"> </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP4" class="function-link"><span class="ACME-function-syntax">sortCoordinatesAsBottomLeftAndTopRight</span></a><span class="ACME-plain-syntax">         </span><span class="ACME-comment-syntax">.rectSourceLeft/Bottom = bottom left</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">coordinates</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">.rectSourceRight/Top   = top right</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">coordinates</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Calculate destination rectangle for the operation.</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Copy the PLOT parameter point (position to move to) into the destination bottom left</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">rectDestinationLeft</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">      </span><span class="ACME-comment-syntax">copy bytes destination</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vdu25ParameterXLow</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">       </span><span class="ACME-comment-syntax">copy bytes source</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP8" class="function-link"><span class="ACME-function-syntax">copyFourBytesWithinVDUVariables</span></a><span class="ACME-plain-syntax">                </span><span class="ACME-comment-syntax">.rectDestinationLeft/Bottom = PLOT</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">parameter point</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STY</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">.vduTempStoreDA =</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">#.rectDestinationRight -</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">.vduVariablesStart</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">                = destination right</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(the destination address for the</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">next calculation)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Calculate:</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">.rectDestinationRight/Top = (source rect top right - source rect bottom left) +</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">destination rectangle bottom left point</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">                          = (source width, height) + destination rectangle bottom left</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">point</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">                          = destination rectangle top right point</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">rectDestinationLeft</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">      </span><span class="ACME-comment-syntax">} .rectDestinationRight = source</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} rect right + dest left - source</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} rect left</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">rectSourceRight</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">          </span><span class="ACME-comment-syntax">} .rectDestinationTop   = source</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} rect top + dest bottom - source</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} rect bottom</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">rectSourceLeft</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">           </span><span class="ACME-comment-syntax">} ie. destination top right</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP8" class="function-link"><span class="ACME-function-syntax">calculatePointVduYPlusVduXMinusVduA</span></a><span class="ACME-plain-syntax">            </span><span class="ACME-comment-syntax">}</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Set X = leftmost of 'source rectangle' and 'dest rectangle'</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Set Y = rightmost of 'source rectangle' and 'dest rectangle'</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">rectSourceLeft</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">           </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">rectDestinationLeft</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">      </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s15.html#SP12" class="function-link"><span class="ACME-function-syntax">sortCoordinatesXYByColumn</span></a><span class="ACME-plain-syntax">                      </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">gxrScratchspace3</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">} [NOTE: redundant instruction]</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TYA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">} Remember Y and X, [NOTE:</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} redundantly preserving A]</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">gxrScratchspace3</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">} [NOTE: redundant instruction]</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Find left edge (clip leftmost point to graphics window)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #0                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP3" class="function-link"><span class="ACME-function-syntax">checkPointIsWithinBounds</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">check within bounds horizontally</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">A is the error code (0 = in bounds, 1 = point is left of graphics window, 2 = point is</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">right of graphics window)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP5" class="function-link"><span class="ACME-function-syntax">yesLeftEdgeInBounds</span></a><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">if (leftmost edge point is in</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">bounds) then branch</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">check if off the left edge</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP5" class="function-link"><span class="ACME-function-syntax">leftEdgeNeedsClipping</span></a><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">if (leftmost edge point is to the</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">left of the graphics window) then</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Leftmost edge is to the right of the graphics window.</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Nothing to do, rectangle is entirely out of bounds, so pull remembered values and return</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">forget about the previously saved X</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">pullAndReturn</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $9ff1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">forget about the previously saved Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">leftEdgeNeedsClipping</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $9ff3</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduGraphicsWindowPixelsLeftLow</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">   </span><span class="ACME-comment-syntax">start at left edge of</span>
<span class="ACME-plain-syntax">                                                                </span><span class="ACME-comment-syntax">graphics window</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">yesLeftEdgeInBounds</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $9ff5</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">At this point X holds the index of the leftmost edge (which has been clipped to graphics</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">window left)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=leftmost of 'source rectangle'</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">left and 'dest rectangle' left</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">coordinates</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceI</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STY</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">where to put results</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">rectSourceLeft</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">           </span><span class="ACME-comment-syntax">Y=source rectangle left coordinate</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP9" class="function-link"><span class="ACME-function-syntax">calculateCoordinateVduYPlusVduXMinusVduA</span></a><span class="ACME-plain-syntax">       </span><span class="ACME-comment-syntax">IJ = source rectangle left</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">coordinate + clipped left edge -</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">leftmost of 'source rectangle' and</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">'dest rectangle' left coordinates</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">   = where in X to start</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">copying/moving from (taking into</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">account any source/destination left</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">clip)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceU</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STY</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">where to put results</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">rectDestinationLeft</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">      </span><span class="ACME-comment-syntax">Y=destination rectangle left</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">coordinate</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP9" class="function-link"><span class="ACME-function-syntax">calculateCoordinateVduYPlusVduXMinusVduA</span></a><span class="ACME-plain-syntax">       </span><span class="ACME-comment-syntax">UV = destination rectangle left</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">coordinate + clipped left edge -</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">leftmost of 'source rectangle' left</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">and 'dest rectangle' left coordinates</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">   = where in X to start</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">copying/moving to (taking into</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">account any source/destination left</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">clip)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=rightmost of 'source rectangle'</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">left and 'dest rectangle' left</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">coordinates</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLC</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ADC</span><span class="ACME-plain-syntax"> #4                                              </span><span class="ACME-comment-syntax">add four to X to get to right</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">coordinate</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAX</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">push A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #0                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP3" class="function-link"><span class="ACME-function-syntax">checkPointIsWithinBounds</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">check if rightmost point is in bounds</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">A is the error code (0 = in bounds, 1 = point is left of graphics window, 2 = point is</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">right of graphics window)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP5" class="function-link"><span class="ACME-function-syntax">yesRightEdgeInBounds</span></a><span class="ACME-plain-syntax">                           </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP5" class="function-link"><span class="ACME-function-syntax">pullAndReturn</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">if (rightmost point is left of the</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">graphics window) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(nothing to do, return)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Rightmost left edge is to the right of the graphics window: clip</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduGraphicsWindowPixelsRightLow</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">  </span><span class="ACME-comment-syntax">right edge</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">yesRightEdgeInBounds</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $a01a</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A=rightmost of 'source rectangle'</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">left and 'dest rectangle' left</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">coordinates</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceY</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STY</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">where to put results</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">rectDestinationRight</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">     </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP9" class="function-link"><span class="ACME-function-syntax">calculateCoordinateVduYPlusVduXMinusVduA</span></a><span class="ACME-plain-syntax">       </span><span class="ACME-comment-syntax">.vduWorkspaceYZ = dest rect right +</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(clipped rightmost left point) -</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(rightmost left point)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">                = clipped right edge</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">of destination</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Which is larger .vduWorkspaceYZ or .vduWorkspaceUV?</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">i.e. which is larger, the destination left edge when clipped, or destination right edge</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">when clipped?</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">i.e. are we completely clipped?</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceY</span></a><span class="ACME-plain-syntax">                                  </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceU</span></a><span class="ACME-plain-syntax">                                  </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceZ</span></a><span class="ACME-plain-syntax">                                  </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SBC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceV</span></a><span class="ACME-plain-syntax">                                  </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP5" class="function-link"><span class="ACME-function-syntax">someOfScreenNeedsMovingOrCopying</span></a><span class="ACME-plain-syntax">               </span><span class="ACME-comment-syntax">if (.vduWorkspaceYZ &gt;=</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">.vduWorkspaceUV) then branch (there</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">are screen pixels that need copying)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">All of the source or all of the destination rectangle is clipped out. Therefore no</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">screen pixels are to be copied/moved.</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Just fill in the source / dest rectangles in the background colour.</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">rectCopyPlotType</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">0=Move, 2=Copy</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP5" class="function-link"><span class="ACME-function-syntax">skipFillSourceRect</span></a><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">if (copy rectangle) then branch</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Move rectangle, so fill source rectangle in background colour</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP3" class="function-link"><span class="ACME-function-syntax">plotRectangleInternal</span></a><span class="ACME-plain-syntax">                          </span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">skipFillSourceRect</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $a03a</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Copy destination rect to source rect</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">rectDestinationLeft</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">      </span><span class="ACME-comment-syntax">source of the 'copy eight bytes'</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">routine</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">rectSourceLeft</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">           </span><span class="ACME-comment-syntax">destination of the 'copy eight</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">bytes' routine</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP8" class="function-link"><span class="ACME-function-syntax">copyEightBytesWithinVDUVariables</span></a><span class="ACME-plain-syntax">               </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Plot source rectangle in background colour, and return</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s14.html#SP3" class="function-link"><span class="ACME-function-syntax">plotRectangleInternal</span></a><span class="ACME-plain-syntax">                          </span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">someOfScreenNeedsMovingOrCopying</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $a044</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #0                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">rectCopyShiftingLeftFlag</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">not shifting left initially (flag =</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">0)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceI</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">source X (low)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP5" class="function-link"><span class="ACME-function-syntax">vduPixelsPerByteMinusOne</span></a><span class="ACME-plain-syntax">                       </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">DA = the offset within the byte to</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">start copying from</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceU</span></a><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">destination X (low)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP5" class="function-link"><span class="ACME-function-syntax">vduPixelsPerByteMinusOne</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">the offset within the byte to start</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">copying to</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEC</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SBC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">compare against the offset within</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">the byte for the source</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (destination offset &gt;= source</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">offset) then branch (shifting bytes</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">right or not at all)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">rectCopyShiftingLeftFlag</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">we are shifting bytes left (flag =</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">255)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP5" class="function-link"><span class="ACME-function-syntax">vduPixelsPerByteMinusOne</span></a><span class="ACME-plain-syntax">                       </span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">rectCopyNumberOfTimesToShiftByte</span></a><span class="ACME-plain-syntax">               </span><span class="ACME-comment-syntax">amount to shift each byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Calculate number of pixels to copy into next byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">EOR</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">} negate A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ADC</span><span class="ACME-plain-syntax"> #1                                              </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP5" class="function-link"><span class="ACME-function-syntax">vduPixelsPerByteMinusOne</span></a><span class="ACME-plain-syntax">                       </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">rectCopyShiftToNextByte</span></a><span class="ACME-plain-syntax">                        </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Calculate pixel mask needed</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">A = amount to shift each byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLC</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ADC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP5" class="function-link"><span class="ACME-function-syntax">vduPixelsPerByteMinusOne</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">add offset based on current MODE</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAX</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s11.html#SP1" class="function-link"><span class="ACME-function-syntax">plotByteMaskTable</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">read mask value for the number of</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">pixels to shift</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">gxrScratchspace2</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">store pixel mask</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Prepare masks and byte width</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceU</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">            </span><span class="ACME-comment-syntax">destination X left</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceY</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">            </span><span class="ACME-comment-syntax">destination X right</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP10" class="function-link"><span class="ACME-function-syntax">rectCopyPrepareMasksAndGetByteWidth</span></a><span class="ACME-plain-syntax">            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">rectCopyByteWidth</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">store byte width</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduCurrentPlotByteMask</span></a><span class="ACME-plain-syntax">                         </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">rectCopyByteMask</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">store into current pixel mask</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDC</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">gxrScratchspace1</span></a><span class="ACME-plain-syntax">                               </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #0                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP7" class="function-link"><span class="ACME-function-syntax">compareCDXwithGHX</span></a><span class="ACME-plain-syntax">                              </span><span class="ACME-comment-syntax">compare .vduWorkspaceCD with</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">.vduWorkspaceGH (top and bottom</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">coordinates)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP5" class="function-link"><span class="ACME-function-syntax">rectCopyOneRow</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">if (top and bottom coordinates are</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">equal) then branch (only one row to</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">copy)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Compare .vduWorkspaceCD with .vduWorkspaceOP (signed)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Work out if we need to copy the rectangle from the top down or the bottom up</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">to avoid overlapping source and destination problems.</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceC</span></a><span class="ACME-plain-syntax">                                  </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceO</span></a><span class="ACME-plain-syntax">                                  </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceD</span></a><span class="ACME-plain-syntax">                                  </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SBC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceP</span></a><span class="ACME-plain-syntax">                                  </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BVC</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (result of subtraction high byte</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">remains within the range -128 to</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">127) then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Result of subtraction high byte moved outside the range -128 to 127</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">EOR</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$80</span><span class="ACME-plain-syntax">                                            </span><span class="ACME-comment-syntax">flip sign bit</span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BMI</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP5" class="function-link"><span class="ACME-function-syntax">rectCopyDecrementingRows</span></a><span class="ACME-plain-syntax">                       </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Main loop to copy rows, incrementing the row each time</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP5" class="function-link"><span class="ACME-function-syntax">rectCopyOneRow</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #0                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP6" class="function-link"><span class="ACME-function-syntax">incWorkspaceCDCompareGH</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">increment .vduWorkspaceCD</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceO</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceC</span></a><span class="ACME-plain-syntax">                </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP6" class="function-link"><span class="ACME-function-syntax">incWorkspaceCDCompareGH</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">increment .vduWorkspaceOP, compare</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">with .vduWorkspaceST</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP5" class="function-link"><span class="ACME-function-syntax">rectCopyOneRow</span></a><span class="ACME-plain-syntax">                                 </span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">rectCopyDecrementingRows</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $a0bc</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceC</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceG</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP8" class="function-link"><span class="ACME-function-syntax">exchangeTwoVDUBytes</span></a><span class="ACME-plain-syntax">                            </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceO</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceS</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP8" class="function-link"><span class="ACME-function-syntax">exchangeTwoVDUBytes</span></a><span class="ACME-plain-syntax">                            </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Main loop to copy rows, decrementing the row each time</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP5" class="function-link"><span class="ACME-function-syntax">rectCopyOneRow</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #0                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP7" class="function-link"><span class="ACME-function-syntax">decWorkspaceCDCompareGH</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">decrement .vduWorkspaceCD</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceO</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceC</span></a><span class="ACME-plain-syntax">                </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP7" class="function-link"><span class="ACME-function-syntax">decWorkspaceCDCompareGH</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">decrement .vduWorkspaceOP, compare</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">with .vduWorkspaceST</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">rectCopyOneRow</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $a0d9</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">.vduWorkspaceKL = .vduWorkspaceCD</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceC</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceK</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP8" class="function-link"><span class="ACME-function-syntax">copyTwoBytesWithinVDUVariables</span></a><span class="ACME-plain-syntax">                 </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">.vduWorkspaceWX = .vduWorkspaceOP</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceO</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceW</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP8" class="function-link"><span class="ACME-function-syntax">copyTwoBytesWithinVDUVariables</span></a><span class="ACME-plain-syntax">                 </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Is .vduWorkspaceCD in the graphics window vertically?</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceC</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP2" class="function-link"><span class="ACME-function-syntax">checkPointIsWithinBoundsVertically</span></a><span class="ACME-plain-syntax">             </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">remember result of bounds test</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Is .vduWorkspaceOP in the graphics window vertically?</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceO</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP2" class="function-link"><span class="ACME-function-syntax">checkPointIsWithinBoundsVertically</span></a><span class="ACME-plain-syntax">             </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP5" class="function-link"><span class="ACME-function-syntax">inBoundsVertically</span></a><span class="ACME-plain-syntax">                             </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP5" class="function-link"><span class="ACME-function-syntax">return32</span></a><span class="ACME-plain-syntax">                                       </span><span class="ACME-comment-syntax">if (.vduWorkspaceCD is out of bounds</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">vertically) then branch (return)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">rectCopyPlotType</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">0=Move, 2=Copy</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP5" class="function-link"><span class="ACME-function-syntax">moveRectRow</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">if (move) then branch</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">return32</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $a0fc</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">moveRectRow</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $a0fd</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceA</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceE</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP5" class="function-link"><span class="ACME-function-syntax">copyCoordinatesSetMasksAndFillRowLocal</span></a><span class="ACME-plain-syntax">         </span><span class="ACME-comment-syntax">[NOTE: no need for this local jump,</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">just JMP</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">.copyCoordinatesSetMasksAndFillRow]</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">inBoundsVertically</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $a104</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">recall result of first bounds test</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP5" class="function-link"><span class="ACME-function-syntax">doneClippingVertically</span></a><span class="ACME-plain-syntax">                         </span><span class="ACME-comment-syntax">if (.vduWorkspaceCD is in bounds)</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">then branch</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Fill row from .vduWorkspaceMN to .vduWorkspaceQR</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceM</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceQ</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">            </span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">copyCoordinatesSetMasksAndFillRowLocal</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $a10b</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s11.html#SP4" class="function-link"><span class="ACME-function-syntax">copyCoordinatesSetMasksAndFillRow</span></a><span class="ACME-plain-syntax">              </span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">doneClippingVertically</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $a10e</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceI</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s11.html#SP7" class="function-link"><span class="ACME-function-syntax">gxrSetScreenAddressAndSetGraphicsColourMask</span></a><span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">prepare graphics variables</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BIT</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">rectCopyShiftingLeftFlag</span></a><span class="ACME-plain-syntax">                       </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BMI</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP5" class="function-link"><span class="ACME-function-syntax">rectCopyRowIntoCache</span></a><span class="ACME-plain-syntax">                           </span><span class="ACME-comment-syntax">if (flag &gt;= 128) then branch</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Decrement graphics cursor cell address by eight</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEC</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduScreenAddressOfGraphicsCursorCellLow</span></a><span class="ACME-plain-syntax">        </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SBC</span><span class="ACME-plain-syntax"> #8                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduScreenAddressOfGraphicsCursorCellLow</span></a><span class="ACME-plain-syntax">        </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCS</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP5" class="function-link"><span class="ACME-function-syntax">rectCopyRowIntoCache</span></a><span class="ACME-plain-syntax">                           </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduScreenAddressOfGraphicsCursorCellHigh</span></a><span class="ACME-plain-syntax">       </span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">rectCopyRowIntoCache</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $a123</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Copy one row of screen pixels into cache, shifting the pixels as needed ready for</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">writing to the destination.</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">rectCopyByteWidth</span></a><span class="ACME-plain-syntax">                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDD</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">store byte width (loop counter)</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">rectCopyRowLoop</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $a128</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">get screen byte</span>
<span class="ACME-element-syntax">!if</span><span class="ACME-plain-syntax"> (</span><span class="ACME-reserved-syntax">MACHINE</span><span class="ACME-plain-syntax"> = </span><span class="ACME-reserved-syntax">BBC_B</span><span class="ACME-plain-syntax">) | (</span><span class="ACME-reserved-syntax">MACHINE</span><span class="ACME-plain-syntax"> = </span><span class="ACME-reserved-syntax">ELECTRON</span><span class="ACME-plain-syntax">) {</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> (.</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduScreenAddressOfGraphicsCursorCellLow</span></a><span class="ACME-plain-syntax">),</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">    </span>
<span class="ACME-plain-syntax">} </span><span class="ACME-reserved-syntax">else</span><span class="ACME-plain-syntax"> </span><span class="ACME-reserved-syntax">if</span><span class="ACME-plain-syntax"> </span><span class="ACME-reserved-syntax">MACHINE</span><span class="ACME-plain-syntax"> = </span><span class="ACME-reserved-syntax">BBC_B_PLUS</span><span class="ACME-plain-syntax"> {</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP8" class="function-link"><span class="ACME-function-syntax">checkPixelIsBackgroundColourFast</span></a><span class="ACME-plain-syntax">               </span><span class="ACME-comment-syntax">read byte from screen</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">EOR</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP5" class="function-link"><span class="ACME-function-syntax">vduBackgroundGraphicsColour</span></a><span class="ACME-plain-syntax">                    </span><span class="ACME-comment-syntax">undo the unwanted eor from</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">subroutine call</span>
<span class="ACME-plain-syntax">} </span><span class="ACME-reserved-syntax">else</span><span class="ACME-plain-syntax"> {</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-identifier-syntax">+</span><span class="ACME-reserved-syntax">unknown_machine</span>
<span class="ACME-plain-syntax">}</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">rectCopyShiftToNextByte</span></a><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">number of times to shift left</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Shift A left by X bits: i.e. A = A &lt;&lt; X</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">shiftByteLeftLoop</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $a12f</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ASL</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP5" class="function-link"><span class="ACME-function-syntax">shiftByteLeftLoop</span></a><span class="ACME-plain-syntax">                              </span>

<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">store pixels from the previous byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEC</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP8" class="function-link"><span class="ACME-function-syntax">moveGraphicsCursorAddressTotheRight</span></a><span class="ACME-plain-syntax">            </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">get screen byte</span>
<span class="ACME-element-syntax">!if</span><span class="ACME-plain-syntax"> (</span><span class="ACME-reserved-syntax">MACHINE</span><span class="ACME-plain-syntax"> = </span><span class="ACME-reserved-syntax">BBC_B</span><span class="ACME-plain-syntax">) | (</span><span class="ACME-reserved-syntax">MACHINE</span><span class="ACME-plain-syntax"> = </span><span class="ACME-reserved-syntax">ELECTRON</span><span class="ACME-plain-syntax">) {</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> (.</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduScreenAddressOfGraphicsCursorCellLow</span></a><span class="ACME-plain-syntax">),</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">    </span>
<span class="ACME-plain-syntax">} </span><span class="ACME-reserved-syntax">else</span><span class="ACME-plain-syntax"> </span><span class="ACME-reserved-syntax">if</span><span class="ACME-plain-syntax"> </span><span class="ACME-reserved-syntax">MACHINE</span><span class="ACME-plain-syntax"> = </span><span class="ACME-reserved-syntax">BBC_B_PLUS</span><span class="ACME-plain-syntax"> {</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">remember DA in X</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP8" class="function-link"><span class="ACME-function-syntax">checkPixelIsBackgroundColourFast</span></a><span class="ACME-plain-syntax">               </span><span class="ACME-comment-syntax">read byte from screen</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">EOR</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP5" class="function-link"><span class="ACME-function-syntax">vduBackgroundGraphicsColour</span></a><span class="ACME-plain-syntax">                    </span><span class="ACME-comment-syntax">undo the unwanted eor from</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">subroutine call</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">undo the unwanted sta from</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">subroutine call</span>
<span class="ACME-plain-syntax">} </span><span class="ACME-reserved-syntax">else</span><span class="ACME-plain-syntax"> {</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-identifier-syntax">+</span><span class="ACME-reserved-syntax">unknown_machine</span>
<span class="ACME-plain-syntax">}</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">rectCopyNumberOfTimesToShiftByte</span></a><span class="ACME-plain-syntax">               </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP5" class="function-link"><span class="ACME-function-syntax">afterShifting</span></a><span class="ACME-plain-syntax">                                  </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Shift A right by X bits: i.e. A = A &gt;&gt; X</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">shiftByteRightLoop</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $a140</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP5" class="function-link"><span class="ACME-function-syntax">shiftByteRightLoop</span></a><span class="ACME-plain-syntax">                             </span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">afterShifting</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $a144</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">EOR</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">gxrScratchspace2</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">} apply pixel mask, with the</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} previous byte data</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">EOR</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDD</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">rectCopyRowCache</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                             </span><span class="ACME-comment-syntax">store into current row data</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDD</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">loop counter</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP5" class="function-link"><span class="ACME-function-syntax">rectCopyRowLoop</span></a><span class="ACME-plain-syntax">                                </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">The row bytes are now stored in cache</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Fill row from .vduWorkspaceMN to .vduWorkspaceQR</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceM</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceQ</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s11.html#SP4" class="function-link"><span class="ACME-function-syntax">copyCoordinatesSetMasksAndFillRow</span></a><span class="ACME-plain-syntax">              </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">If moving rather than copying, call .moveRectRow</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">rectCopyPlotType</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">0=Move, 2=Copy</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP5" class="function-link"><span class="ACME-function-syntax">rectSkipMove</span></a><span class="ACME-plain-syntax">                                   </span><span class="ACME-comment-syntax">if (copy) then branch</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP5" class="function-link"><span class="ACME-function-syntax">moveRectRow</span></a><span class="ACME-plain-syntax">                                    </span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">rectSkipMove</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $a163</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #.</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceU</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s11.html#SP7" class="function-link"><span class="ACME-function-syntax">gxrSetScreenAddressAndSetGraphicsColourMask</span></a><span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">prepare graphics variables</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Write the mask of the initial byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">rectCopyByteMask</span></a><span class="ACME-plain-syntax">                               </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">If width is zero, then there are no whole bytes to copy, jump forward</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">rectCopyByteWidth</span></a><span class="ACME-plain-syntax">                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP5" class="function-link"><span class="ACME-function-syntax">rectHaveFilledRowWholeBytes</span></a><span class="ACME-plain-syntax">                    </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Write the first byte of the row, a masked partial byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP5" class="function-link"><span class="ACME-function-syntax">rectWritePatternByteMasked</span></a><span class="ACME-plain-syntax">                     </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Now make the mask full for the run of whole bytes to write</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                                            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Write the whole bytes along the row in a loop</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP5" class="function-link"><span class="ACME-function-syntax">rectPatternFillRowEntry</span></a><span class="ACME-plain-syntax">                        </span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">rectPatternFillRowLoop</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $a17c</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">rectCopyRowCache</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                             </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">store screen byte</span>
<span class="ACME-element-syntax">!if</span><span class="ACME-plain-syntax"> (</span><span class="ACME-reserved-syntax">MACHINE</span><span class="ACME-plain-syntax"> = </span><span class="ACME-reserved-syntax">BBC_B</span><span class="ACME-plain-syntax">) | (</span><span class="ACME-reserved-syntax">MACHINE</span><span class="ACME-plain-syntax"> = </span><span class="ACME-reserved-syntax">ELECTRON</span><span class="ACME-plain-syntax">) {</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> (.</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduScreenAddressOfGraphicsCursorCellLow</span></a><span class="ACME-plain-syntax">),</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">    </span>
<span class="ACME-plain-syntax">} </span><span class="ACME-reserved-syntax">else</span><span class="ACME-plain-syntax"> </span><span class="ACME-reserved-syntax">if</span><span class="ACME-plain-syntax"> </span><span class="ACME-reserved-syntax">MACHINE</span><span class="ACME-plain-syntax"> = </span><span class="ACME-reserved-syntax">BBC_B_PLUS</span><span class="ACME-plain-syntax"> {</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP8" class="function-link"><span class="ACME-function-syntax">plotFast</span></a><span class="ACME-plain-syntax">                                       </span><span class="ACME-comment-syntax">write byte to screen</span>
<span class="ACME-plain-syntax">} </span><span class="ACME-reserved-syntax">else</span><span class="ACME-plain-syntax"> {</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-identifier-syntax">+</span><span class="ACME-reserved-syntax">unknown_machine</span>
<span class="ACME-plain-syntax">}</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">rectPatternFillRowEntry</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $a181</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEC</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP8" class="function-link"><span class="ACME-function-syntax">moveGraphicsCursorAddressTotheRight</span></a><span class="ACME-plain-syntax">            </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP5" class="function-link"><span class="ACME-function-syntax">rectPatternFillRowLoop</span></a><span class="ACME-plain-syntax">                         </span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">rectHaveFilledRowWholeBytes</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $a188</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">With the whole bytes done, create a mask for the final byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">gxrScratchspace1</span></a><span class="ACME-plain-syntax">                               </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">EOR</span><span class="ACME-plain-syntax"> #</span><span class="ACME-constant-syntax">$FF</span><span class="ACME-plain-syntax">                                            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">rectWritePatternByteMasked</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $a191</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Write the final byte of the row</span>
<span class="ACME-element-syntax">!if</span><span class="ACME-plain-syntax"> (</span><span class="ACME-reserved-syntax">MACHINE</span><span class="ACME-plain-syntax"> = </span><span class="ACME-reserved-syntax">BBC_B</span><span class="ACME-plain-syntax">) | (</span><span class="ACME-reserved-syntax">MACHINE</span><span class="ACME-plain-syntax"> = </span><span class="ACME-reserved-syntax">ELECTRON</span><span class="ACME-plain-syntax">) {</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">rectCopyRowCache</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                             </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">EOR</span><span class="ACME-plain-syntax"> (.</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduScreenAddressOfGraphicsCursorCellLow</span></a><span class="ACME-plain-syntax">),</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">EOR</span><span class="ACME-plain-syntax"> (.</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduScreenAddressOfGraphicsCursorCellLow</span></a><span class="ACME-plain-syntax">),</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> (.</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduScreenAddressOfGraphicsCursorCellLow</span></a><span class="ACME-plain-syntax">),</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">} </span><span class="ACME-reserved-syntax">else</span><span class="ACME-plain-syntax"> </span><span class="ACME-reserved-syntax">if</span><span class="ACME-plain-syntax"> </span><span class="ACME-reserved-syntax">MACHINE</span><span class="ACME-plain-syntax"> = </span><span class="ACME-reserved-syntax">BBC_B_PLUS</span><span class="ACME-plain-syntax"> {</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">stash value at $DA which subroutine</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">call will corrupt</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDB</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP8" class="function-link"><span class="ACME-function-syntax">checkPixelIsBackgroundColourFast</span></a><span class="ACME-plain-syntax">               </span><span class="ACME-comment-syntax">read byte from screen</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">EOR</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP5" class="function-link"><span class="ACME-function-syntax">vduBackgroundGraphicsColour</span></a><span class="ACME-plain-syntax">                    </span><span class="ACME-comment-syntax">undo the unwanted eor from</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">subroutine call</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">set $DA to ($D6),Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">EOR</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">rectCopyRowCache</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                             </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDB</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">EOR</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP8" class="function-link"><span class="ACME-function-syntax">plotFast</span></a><span class="ACME-plain-syntax">                                       </span><span class="ACME-comment-syntax">write byte to screen</span>
<span class="ACME-plain-syntax">} </span><span class="ACME-reserved-syntax">else</span><span class="ACME-plain-syntax"> {</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-identifier-syntax">+</span><span class="ACME-reserved-syntax">unknown_machine</span>
<span class="ACME-plain-syntax">}</span>
</pre>
<p class="commentary firstcommentary"><a id="SP6" class="paragraph-anchor"></a><b>&#167;6. Helper for rectangle copy (increment and compare). </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Increment    .vduWorkspaceCD[X]</span>
<span class="ACME-plain-syntax"> Compare with .vduWorkspaceGH[X]</span>

<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">   X: offset from .vduWorkspaceC (in practice 0 for .vduWorkspaceCD or 12 for .vduWorkspaceOP)</span>
<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">   C,Z: We set flags comparing .vduWorkspaceCD[X] with .vduWorkspaceGH[X]</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">incWorkspaceCDCompareGH</span><button class="popup" onclick="togglePopup('usagePopup5')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup5">Usage of <span class="code-font"><span class="ACME-function-syntax">incWorkspaceCDCompareGH</span></span>:<br/><a href="S-s19.html#SP5">&#167;5</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $a19d</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Increment .vduWorkspaceCD[X]</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceC</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP7" class="function-link"><span class="ACME-function-syntax">compareCDXwithGHX</span></a><span class="ACME-plain-syntax">                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceD</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP7" class="function-link"><span class="ACME-function-syntax">compareCDXwithGHX</span></a><span class="ACME-plain-syntax">                              </span>
</pre>
<p class="commentary firstcommentary"><a id="SP7" class="paragraph-anchor"></a><b>&#167;7. Helper for rectangle copy (decrement and compare). </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Decrement    .vduWorkspaceCD[X]</span>
<span class="ACME-plain-syntax"> Compare with .vduWorkspaceGH[X]</span>

<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">   X: offset from .vduWorkspaceC (in practice 0=.vduWorkspaceCD or 12=.vduWorkspaceOP)</span>
<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">   C,Z: We set flags comparing .vduWorkspaceCD[X] with .vduWorkspaceGH[X]</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">decWorkspaceCDCompareGH</span><button class="popup" onclick="togglePopup('usagePopup6')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup6">Usage of <span class="code-font"><span class="ACME-function-syntax">decWorkspaceCDCompareGH</span></span>:<br/><a href="S-s19.html#SP5">&#167;5</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $a1a8</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Decrement .vduWorkspaceCD[X]</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceC</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceD</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                </span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceC</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                </span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">compareCDXwithGHX</span><button class="popup" onclick="togglePopup('usagePopup7')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup7">Usage of <span class="code-font"><span class="ACME-function-syntax">compareCDXwithGHX</span></span>:<br/><a href="S-s19.html#SP5">&#167;5</a>, <a href="S-s19.html#SP6">&#167;6</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $a1b3</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceC</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceG</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceD</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP4" class="function-link"><span class="ACME-function-syntax">vduWorkspaceH</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                </span>
<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP8" class="paragraph-anchor"></a><b>&#167;8. Add two points and subtract a third. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> vdu[.vduTempStoreDA,DB]     = vdu[Y+0,Y+1] + vdu[X+0,X+1] - vdu[A+0, A+1]</span>
<span class="ACME-plain-syntax"> vdu[(.vduTempStoreDA,DB)+2] = vdu[Y+2,Y+3] + vdu[X+2,X+3] - vdu[A+2, A+3]</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">calculatePointVduYPlusVduXMinusVduA</span><button class="popup" onclick="togglePopup('usagePopup8')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup8">Usage of <span class="code-font"><span class="ACME-function-syntax">calculatePointVduYPlusVduXMinusVduA</span></span>:<br/><a href="S-s19.html#SP5">&#167;5</a><br/>Chapter 20: Sprite plotting - <a href="S-s20.html#SP1">&#167;1</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $a1c2</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP9" class="function-link"><span class="ACME-function-syntax">calculateCoordinateVduYPlusVduXMinusVduA</span></a><span class="ACME-plain-syntax">       </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Move A,X,Y,and DA on by 2 for Y coordinates</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INY</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INY</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INX</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INX</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLC</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ADC</span><span class="ACME-plain-syntax"> #2                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP9" class="paragraph-anchor"></a><b>&#167;9. Add two coordinates and subtract a third. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> vdu[vduTempStoreDA,DB] = vdu[Y,Y+1] + vdu[X,X+1] - vdu[A, A+1]</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">calculateCoordinateVduYPlusVduXMinusVduA</span><button class="popup" onclick="togglePopup('usagePopup9')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup9">Usage of <span class="code-font"><span class="ACME-function-syntax">calculateCoordinateVduYPlusVduXMinusVduA</span></span>:<br/><a href="S-s19.html#SP5">&#167;5</a>, <a href="S-s19.html#SP8">&#167;8</a><br/>Chapter 20: Sprite plotting - <a href="S-s20.html#SP1">&#167;1</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $a1d0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">gxrScratchspace3</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TXA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">} Remember X,Y, preserving A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TYA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">gxrScratchspace3</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">}</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">remember A</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">DE/Scratchspace3 = vdu[X] + vdu[Y]</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLC</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ADC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDE</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">DE = vdu[X] + vdu[Y]</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">1,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                          </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ADC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">1,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                          </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">gxrScratchspace3</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">scratchspace = vdu[X+1] + vdu[Y+1]</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">recall A</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">X=original A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">gxrScratchspace3</span></a><span class="ACME-plain-syntax">                               </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">remember vdu[X+1] + vdu[Y+1]</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">vdu[vduTempStoreDA] = DE/Scratchspace3 - vdu[A]</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDA</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">Y=DA</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDE</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SBC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">} vdu[.vduTempStoreDA] = vdu[X] +</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">} vdu[originalY] - vdu[originalA]</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">recall A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SBC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">1,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                          </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">1,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">vdu[.vduTempStoreDA+1] = vdu[X+1] +</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">vdu[originalY+1] - vdu[originalA+1]</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">gxrScratchspace3</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">remember original A</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">} Recall A,X,Y</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAX</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">gxrScratchspace3</span></a><span class="ACME-plain-syntax">                               </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP10" class="paragraph-anchor"></a><b>&#167;10. Prepare masks ready for the rectangle copy, and return the width in bytes.. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">   .vduTempStoreDC:         pixel mask</span>
<span class="ACME-plain-syntax">   .vduCurrentPlotByteMask: pixel mask</span>
<span class="ACME-plain-syntax">   A = byte width to copy</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">rectCopyPrepareMasksAndGetByteWidth</span><button class="popup" onclick="togglePopup('usagePopup10')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup10">Usage of <span class="code-font"><span class="ACME-function-syntax">rectCopyPrepareMasksAndGetByteWidth</span></span>:<br/><a href="S-s19.html#SP5">&#167;5</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $a210</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">1,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">} push destination right X coordinate</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PHA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">}</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Calculate Y = table offset</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP5" class="function-link"><span class="ACME-function-syntax">vduPixelsPerByteMinusOne</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">get offset within a byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLC</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ADC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP5" class="function-link"><span class="ACME-function-syntax">vduPixelsPerByteMinusOne</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">add value based on current MODE</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Read the byte value that will set one pixel to white leaving the remainder black.</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP8" class="function-link"><span class="ACME-function-syntax">sixteenColourMODEMaskTable</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">               </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">EOR</span><span class="ACME-plain-syntax"> .</span><a href="S-s11.html#SP1" class="function-link"><span class="ACME-function-syntax">plotByteMaskTable</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                        </span><span class="ACME-comment-syntax">just the rightmost pixels</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDC</span></a><span class="ACME-plain-syntax">                                 </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">leftmost destination X coordinate</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Calculate Y = table offset</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">AND</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP5" class="function-link"><span class="ACME-function-syntax">vduPixelsPerByteMinusOne</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">get offset within a byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ADC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP5" class="function-link"><span class="ACME-function-syntax">vduPixelsPerByteMinusOne</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">add value based on current MODE</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s11.html#SP1" class="function-link"><span class="ACME-function-syntax">plotByteMaskTable</span></a><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">1</span><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                        </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduCurrentPlotByteMask</span></a><span class="ACME-plain-syntax">                         </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Calculate (A, vduTempStoreDD) = byte width to copy</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEC</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">destination right X coordinate (low)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ORA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP5" class="function-link"><span class="ACME-function-syntax">vduPixelsPerByteMinusOne</span></a><span class="ACME-plain-syntax">                       </span><span class="ACME-comment-syntax">round up to a byte's worth</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SBC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">take of the left edge (low)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TAY</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">remember in Y</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">PLA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">destination right X coordinate (high)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SBC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">1,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">take off left edge (high byte)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDD</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">store</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">TYA</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">recall low byte</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">A is low byte</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">.vduTempStoreDD is high byte</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">MODE  vduPixelsPerByteMinusOne    divide</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax"> 0    7                           /8</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax"> 1    3                           /4</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax"> 2    1                           /2</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax"> 3    (not a graphics mode)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax"> 4    7                           /8</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax"> 5    3                           /4</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP5" class="function-link"><span class="ACME-function-syntax">vduPixelsPerByteMinusOne</span></a><span class="ACME-plain-syntax">                       </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CPY</span><span class="ACME-plain-syntax"> #3                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP10" class="function-link"><span class="ACME-function-syntax">divideTwo</span></a><span class="ACME-plain-syntax">                                      </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s19.html#SP10" class="function-link"><span class="ACME-function-syntax">divideLow</span></a><span class="ACME-plain-syntax">                                      </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Divide by four</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDD</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROR</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">divideTwo</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $a253</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDD</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROR</span><span class="ACME-plain-syntax">                                                 </span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">divideLow</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $a256</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">divide low byte by two. No need to</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">divide high byte by two, since it</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">will already be zero by this point.</span>
</pre>
<nav role="progress"><div class="progresscontainer">
    <ul class="progressbar"><li class="progressprev"><a href="S-s18.html">&#10094;</a></li><li class="progresssection"><a href="S-s1.html">1</a></li><li class="progresssection"><a href="S-s2.html">2</a></li><li class="progresssection"><a href="S-s3.html">3</a></li><li class="progresssection"><a href="S-s4.html">4</a></li><li class="progresssection"><a href="S-s5.html">5</a></li><li class="progresssection"><a href="S-s6.html">6</a></li><li class="progresssection"><a href="S-s7.html">7</a></li><li class="progresssection"><a href="S-s8.html">8</a></li><li class="progresssection"><a href="S-s9.html">9</a></li><li class="progresssection"><a href="S-s10.html">10</a></li><li class="progresssection"><a href="S-s11.html">11</a></li><li class="progresssection"><a href="S-s12.html">12</a></li><li class="progresssection"><a href="S-s13.html">13</a></li><li class="progresssection"><a href="S-s14.html">14</a></li><li class="progresssection"><a href="S-s15.html">15</a></li><li class="progresssection"><a href="S-s16.html">16</a></li><li class="progresssection"><a href="S-s17.html">17</a></li><li class="progresssection"><a href="S-s18.html">18</a></li><li class="progresscurrent">19</li><li class="progresssection"><a href="S-s20.html">20</a></li><li class="progresssection"><a href="S-s21.html">21</a></li><li class="progresssection"><a href="S-s22.html">22</a></li><li class="progresssection"><a href="S-s23.html">23</a></li><li class="progresssection"><a href="S-s24.html">24</a></li><li class="progresssection"><a href="S-s25.html">25</a></li><li class="progressnext"><a href="S-s20.html">&#10095;</a></li></ul></div>
</nav><!--End of weave-->

		</main>
	</body>
</html>

