<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>Chapter 24: Maths routines</title>
<link href="../docs-assets/Breadcrumbs.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Breadcrumbs.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Carousel.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Navigation.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Base.css" rel="stylesheet" rev="stylesheet" type="text/css">
		<meta name="viewport" content="width=device-width initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta http-equiv="Content-Language" content="en-gb">

<link href="../docs-assets/Contents.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Progress.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Fonts.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/Popups.css" rel="stylesheet" rev="stylesheet" type="text/css">
<script>
function togglePopup(material_id) {
  var popup = document.getElementById(material_id);
  popup.classList.toggle("show");
}
</script>

<link href="../docs-assets/Colours.css" rel="stylesheet" rev="stylesheet" type="text/css">
<link href="../docs-assets/ACME-Colours.css" rel="stylesheet" rev="stylesheet" type="text/css">
		
	</head>
	<body class="commentary-font">
		<nav role="navigation">
		<p>BBC Computer 32K</p>
<h1>*GXR</h1>
<ul><li><a href="../index.html">&#x21A9; home</a></li><li><a href="index.html"><span class="selectedlink">contents</span></a></li>
<li><a href="S-s1.html">introduction</a></li>
<li><a href="S-s2.html">constants</a></li>
<li><a href="S-s3.html">memory addresses</a></li>
<li><a href="S-s4.html"><b>$8000</b>: chapter 4</a></li>
<li><a href="S-s5.html"><b>$8167</b>: chapter 5</a></li>
<li><a href="S-s6.html"><b>$82a9</b>: chapter 6</a></li>
<li><a href="S-s7.html"><b>$8349</b>: chapter 7</a></li>
<li><a href="S-s8.html"><b>$88f9</b>: chapter 8</a></li>
<li><a href="S-s9.html"><b>$8955</b>: chapter 9</a></li>
<li><a href="S-s10.html"><b>$899d</b>: chapter 10</a></li>
<li><a href="S-s11.html"><b>$8a8a</b>: chapter 11</a></li>
<li><a href="S-s12.html"><b>$8bb4</b>: chapter 12</a></li>
<li><a href="S-s13.html"><b>$8d83</b>: chapter 13</a></li>
<li><a href="S-s14.html"><b>$8dd2</b>: chapter 14</a></li>
<li><a href="S-s15.html"><b>$8e5b</b>: chapter 15</a></li>
<li><a href="S-s16.html"><b>$9044</b>: chapter 16</a></li>
<li><a href="S-s17.html"><b>$9872</b>: chapter 17</a></li>
<li><a href="S-s18.html"><b>$9ced</b>: chapter 18</a></li>
<li><a href="S-s19.html"><b>$9f7c</b>: chapter 19</a></li>
<li><a href="S-s20.html"><b>$a258</b>: chapter 20</a></li>
<li><a href="S-s21.html"><b>$a40e</b>: chapter 21</a></li>
<li><a href="S-s22.html"><b>$a808</b>: chapter 22</a></li>
<li><a href="S-s23.html"><b>$b9ea</b>: chapter 23</a></li>
<li><span class="unlink"><b>$bdd0</b>: chapter 24</span></li>
<li><a href="S-s25.html"><b>$bfdb</b>: chapter 25</a></li>

</ul>
		</nav>
		<main role="main">
		<!--Weave of 'Chapter 24: Maths routines' generated by Inweb-->
<div class="breadcrumbs">
    <ul class="crumbs"><li><a href="../index.html">Home</a></li><li><a href="index.html">GXR</a></li><li><b>Chapter 24: Maths routines</b></li></ul></div>
<p class="purpose">Multiply; Divide; Square Root; Abs(a-b); Negate - 503 bytes (3%)</p>

<ul class="toc"><li><a href="S-s24.html#SP1">&#167;1. Unsigned divide (24 bit / 16 bit)</a></li><li><a href="S-s24.html#SP2">&#167;2. Absolute difference (16 bit)</a></li><li><a href="S-s24.html#SP3">&#167;3. Negation (16 bit)</a></li><li><a href="S-s24.html#SP4">&#167;4. 16 bit multiply</a></li><li><a href="S-s24.html#SP5">&#167;5. 24 bit multiply</a></li><li><a href="S-s24.html#SP6">&#167;6. 32 bit square root</a></li><li><a href="S-s24.html#SP7">&#167;7. 48 bit square root</a></li></ul><hr class="tocbar">

<p class="commentary firstcommentary"><a id="SP1" class="paragraph-anchor"></a><b>&#167;1. Unsigned divide (24 bit / 16 bit). </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> 24 bit dividend over 16 bit divisor, result is 24 bit quotient</span>

<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">   X: VDU variable for 24 bit dividend</span>
<span class="ACME-plain-syntax">   Y: VDU variable for 16 bit divisor</span>
<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">   24 bit quotient result has overwritten the dividend (at VDU variable X)</span>
<span class="ACME-plain-syntax">   carry: if set means a divide by zero error</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">divide24by16bits</span><button class="popup" onclick="togglePopup('usagePopup1')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup1">Usage of <span class="code-font"><span class="ACME-function-syntax">divide24by16bits</span></span>:<br/>Chapter 23: Ellipse - <a href="S-s23.html#SP5">&#167;5</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $bdd0</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Copy variables into zero page workspace</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STX</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDE</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">remember VDU variable for dividend</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Copy 24 bit dividend into zero page</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">read dividend</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">dividend0</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">store in zp</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">1,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">read dividend</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">dividend1</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">store in zp</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">2,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">read dividend</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">dividend2</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">store in zp</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Copy 16 bit divisor into zero page</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">read divisor</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">divisor1</span></a><span class="ACME-plain-syntax">                                       </span><span class="ACME-comment-syntax">store in zp</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">1,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">read divisor</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">divisor2</span></a><span class="ACME-plain-syntax">                                       </span><span class="ACME-comment-syntax">store in zp</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Keep doubling divisor until the top bit is set</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #8                                              </span><span class="ACME-comment-syntax">X is 8 + number of times divisor is</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">doubled</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #16                                             </span><span class="ACME-comment-syntax">loop counter, loop up to 16 times</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">divisor2</span></a><span class="ACME-plain-syntax">                                       </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BMI</span><span class="ACME-plain-syntax"> .</span><a href="S-s24.html#SP1" class="function-link"><span class="ACME-function-syntax">divideMain</span></a><span class="ACME-plain-syntax">                                     </span><span class="ACME-comment-syntax">branch if done already</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">INX</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ASL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">divisor1</span></a><span class="ACME-plain-syntax">                                       </span><span class="ACME-comment-syntax">} scale up 16 bit divisor</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">divisor2</span></a><span class="ACME-plain-syntax">                                       </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BMI</span><span class="ACME-plain-syntax"> .</span><a href="S-s24.html#SP1" class="function-link"><span class="ACME-function-syntax">divideMain</span></a><span class="ACME-plain-syntax">                                     </span><span class="ACME-comment-syntax">branch if done</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEY</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BNE</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">If we get this far, it must be a zero divisor - so error out!</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">carry set = divide by zero error</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s24.html#SP1" class="function-link"><span class="ACME-function-syntax">divideCopyBackQuotientResult</span></a><span class="ACME-plain-syntax">                   </span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">divideMain</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $be09</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">At this point, X is the loop counter.</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">i.e. We loop for X = 8 + number of times the divisor has been scaled up</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #0                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">divisor0</span></a><span class="ACME-plain-syntax">                                       </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">quotient0</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">zero quotient (result)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">quotient1</span></a><span class="ACME-plain-syntax">                                      </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">quotient2</span></a><span class="ACME-plain-syntax">                                      </span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">divideLoop</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $be17</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">temp = dividend - divisor</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEC</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">dividend0</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">dividend</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SBC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">divisor0</span></a><span class="ACME-plain-syntax">                                       </span><span class="ACME-comment-syntax">subtract divisor</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">divideTemp0</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">store temp</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">dividend1</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">dividend</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SBC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">divisor1</span></a><span class="ACME-plain-syntax">                                       </span><span class="ACME-comment-syntax">subtract divisor</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">divideTemp1</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">store temp</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">dividend2</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">dividend</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SBC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">divisor2</span></a><span class="ACME-plain-syntax">                                       </span><span class="ACME-comment-syntax">subtract divisor</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">divideTemp2</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">store temp</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s24.html#SP1" class="function-link"><span class="ACME-function-syntax">divideSkip</span></a><span class="ACME-plain-syntax">                                     </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">dividend = temp</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #2                                              </span><span class="ACME-comment-syntax">loop counter, loop 3 times to set 3</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">byte dividend</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">divideTemp0</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                                  </span><span class="ACME-comment-syntax">temp</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">dividend0</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                                    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEY</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">divideSkip</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $be40</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">quotient0</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">shift quotient</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">quotient1</span></a><span class="ACME-plain-syntax">                                      </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">quotient2</span></a><span class="ACME-plain-syntax">                                      </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">divisor2</span></a><span class="ACME-plain-syntax">                                       </span><span class="ACME-comment-syntax">shift divisor</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROR</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">divisor1</span></a><span class="ACME-plain-syntax">                                       </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROR</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">divisor0</span></a><span class="ACME-plain-syntax">                                       </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> .</span><a href="S-s24.html#SP1" class="function-link"><span class="ACME-function-syntax">divideLoop</span></a><span class="ACME-plain-syntax">                                     </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">carry clear = valid result</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">divideCopyBackQuotientResult</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $be56</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Write quotient back into dividend VDU variables</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDE</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">recall VDU variable for dividend</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">quotient0</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">and write quotient into it</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">quotient1</span></a><span class="ACME-plain-syntax">                                      </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">1,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                          </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">quotient2</span></a><span class="ACME-plain-syntax">                                      </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">2,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                          </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP2" class="paragraph-anchor"></a><b>&#167;2. Absolute difference (16 bit). </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Get the absolute value of the difference between VDU variables Y and X, and store it in</span>
<span class="ACME-plain-syntax"> VDU variable A.</span>

<span class="ACME-plain-syntax"> vdu[A] = abs(vdu[Y] - vdu[X])</span>

<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">   X,Y: VDU variables</span>
<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">   vdu[A]</span>
<span class="ACME-plain-syntax">   carry is set if vdu[Y] &lt; vdu[X]</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">absDifference16</span><button class="popup" onclick="togglePopup('usagePopup2')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup2">Usage of <span class="code-font"><span class="ACME-function-syntax">absDifference16</span></span>:<br/>Chapter 23: Ellipse - <a href="S-s23.html#SP5">&#167;5</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $be6b</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDF</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">remember VDU variable for the result</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEC</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SBC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDE</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">.vduTempStoreDE = vdu[Y]-vdu[X] (low)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">1,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                          </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SBC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">1,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                          </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDF</span></a><span class="ACME-plain-syntax">                                 </span><span class="ACME-comment-syntax">recall VDU variable for the result</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">1,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                          </span><span class="ACME-comment-syntax">store high byte of result</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">carry = top bit (negative flag)</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP2" class="function-link"><span class="ACME-function-syntax">vduTempStoreDE</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                            </span><span class="ACME-comment-syntax">store low byte of result</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s24.html#SP2" class="function-link"><span class="ACME-function-syntax">return11</span></a><span class="ACME-plain-syntax">                                       </span><span class="ACME-comment-syntax">if not negative then branch (return)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Negate result</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #0                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SBC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #0                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SBC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">1,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                          </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">1,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                          </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEC</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">return11</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $be9a</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP3" class="paragraph-anchor"></a><b>&#167;3. Negation (16 bit). </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> the 16 bit value in VDU variable X and place the result in VDU variable Y</span>

<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">   X,Y are the offsets into the VDU variables to negate</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">negateVDUVariableXIntoY</span><button class="popup" onclick="togglePopup('usagePopup3')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup3">Usage of <span class="code-font"><span class="ACME-function-syntax">negateVDUVariableXIntoY</span></span>:<br/>Chapter 23: Ellipse - <a href="S-s23.html#SP4">&#167;4</a>, <a href="S-s23.html#SP5">&#167;5</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $be9b</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEC</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #0                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SBC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                            </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #0                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SBC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">1,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                          </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP3" class="function-link"><span class="ACME-function-syntax">vduVariablesStart</span></a><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">1,</span><span class="ACME-reserved-syntax">Y</span><span class="ACME-plain-syntax">                          </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP4" class="paragraph-anchor"></a><b>&#167;4. 16 bit multiply. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> 16 bit x 16 bit unsigned multiply, 32 bit result. This is implemented by calling a 24x24</span>
<span class="ACME-plain-syntax"> bit multiply with the top bytes zero. [NOTE: This is far from efficient in performance!]</span>

<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">   .multiplicand01: 16 bit number</span>
<span class="ACME-plain-syntax">   .multiplier01:   16 bit number</span>
<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">   product:      48 bit result (top two bytes zero), shares memory with multiplier</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">multiply16x16</span><button class="popup" onclick="togglePopup('usagePopup4')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup4">Usage of <span class="code-font"><span class="ACME-function-syntax">multiply16x16</span></span>:<br/>Chapter 16: Circle - <a href="S-s16.html#SP13">&#167;13</a>, <a href="S-s16.html#SP17">&#167;17</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $bead</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #0                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">multiplier2</span></a><span class="ACME-plain-syntax">                                    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">multiplicand2</span></a><span class="ACME-plain-syntax">                                  </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP5" class="paragraph-anchor"></a><b>&#167;5. 24 bit multiply. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> 24 bit x 24 bit unsigned multiply, 48 bit result</span>

<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">   .multiplicand012: 24 bit number</span>
<span class="ACME-plain-syntax">   .multiplier012:   24 bit number</span>
<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">   product:      48 bit result, shares memory with multiplier</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">multiply24x24</span><button class="popup" onclick="togglePopup('usagePopup5')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup5">Usage of <span class="code-font"><span class="ACME-function-syntax">multiply24x24</span></span>:<br/>Chapter 23: Ellipse - <a href="S-s23.html#SP7">&#167;7</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $beb5</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LSR</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">multiplier2</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROR</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">multiplier1</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">} rotate 24 bit multiplier right</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROR</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">multiplier0</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Carry contains the lowest bit of the multiplier rotated out</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #0                                              </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">product5</span></a><span class="ACME-plain-syntax">                                       </span><span class="ACME-comment-syntax">} zero the top half of the result</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">product4</span></a><span class="ACME-plain-syntax">                                       </span><span class="ACME-comment-syntax">}</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">product3</span></a><span class="ACME-plain-syntax">                                       </span><span class="ACME-comment-syntax">}</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDY</span><span class="ACME-plain-syntax"> #23                                             </span><span class="ACME-comment-syntax">loop counter: loops 24 times</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">multiplyLoop</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $becb</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s24.html#SP5" class="function-link"><span class="ACME-function-syntax">skipAdd</span></a><span class="ACME-plain-syntax">                                        </span><span class="ACME-comment-syntax">carry contains the lowest bit from</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">the multiplier.</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">branch if not set</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLC</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">multiplicand0</span></a><span class="ACME-plain-syntax">                                  </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ADC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">product3</span></a><span class="ACME-plain-syntax">                                       </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">product3</span></a><span class="ACME-plain-syntax">                                       </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">multiplicand1</span></a><span class="ACME-plain-syntax">                                  </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ADC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">product4</span></a><span class="ACME-plain-syntax">                                       </span><span class="ACME-comment-syntax">product345 += multiplicand</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">product4</span></a><span class="ACME-plain-syntax">                                       </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">multiplicand2</span></a><span class="ACME-plain-syntax">                                  </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ADC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">product5</span></a><span class="ACME-plain-syntax">                                       </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">product5</span></a><span class="ACME-plain-syntax">                                       </span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">skipAdd</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $bee9</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Shift the 48 bit result right</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">CLC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">[BUG: this CLC instruction should be</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">removed to make</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">      top bit set numbers produce</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">the correct result]</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #5                                              </span><span class="ACME-comment-syntax">loop counter: loops 6 times</span>
<span class="ACME-identifier-syntax">-</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROR</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">product0</span></a><span class="ACME-plain-syntax">,</span><span class="ACME-reserved-syntax">X</span><span class="ACME-plain-syntax">                                     </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">-</span><span class="ACME-plain-syntax">                                               </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Carry contains the lowest bit of the multiplier rotated out (remember that the</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">multiplier shares memory with product)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEY</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BPL</span><span class="ACME-plain-syntax"> .</span><a href="S-s24.html#SP5" class="function-link"><span class="ACME-function-syntax">multiplyLoop</span></a><span class="ACME-plain-syntax">                                   </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>
</pre>
<p class="commentary firstcommentary"><a id="SP6" class="paragraph-anchor"></a><b>&#167;6. 32 bit square root. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Find square root of a 32 bit unsigned integer. [NOTE: This just falls through into the 48 bit</span>
<span class="ACME-plain-syntax"> square root function with the high bytes zero. This is not a good strategy for the best</span>
<span class="ACME-plain-syntax"> performance.]</span>

<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">   .sqrtNumber0123: number to sqrt (32 bits)</span>
<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">   .sqrtResult01: root (16 bits)</span>
<span class="ACME-plain-syntax">   (.sqrtRemainder0123:  32 bit remainder is unused)</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">sqrt32</span><button class="popup" onclick="togglePopup('usagePopup6')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup6">Usage of <span class="code-font"><span class="ACME-function-syntax">sqrt32</span></span>:<br/>Chapter 16: Circle - <a href="S-s16.html#SP5">&#167;5</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $bef6</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #0                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtNumber4</span></a><span class="ACME-plain-syntax">                                    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtNumber5</span></a><span class="ACME-plain-syntax">                                    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">fall through...</span>
</pre>
<p class="commentary firstcommentary"><a id="SP7" class="paragraph-anchor"></a><b>&#167;7. 48 bit square root. </b></p>

<pre class="ACME-undisplayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax"> Find square root of a 48 bit unsigned integer.</span>

<span class="ACME-plain-syntax"> On Entry:</span>
<span class="ACME-plain-syntax">   sqrtNumber012345: number to sqrt (48 bits)</span>
<span class="ACME-plain-syntax"> On Exit:</span>
<span class="ACME-plain-syntax">   sqrtResult012: root (24 bits)</span>
<span class="ACME-plain-syntax">   (.sqrtRemainder0123:  32 bit remainder is unused)</span>
</pre>
<pre class="ACME-displayed-code all-displayed-code code-font">
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">sqrt48</span><button class="popup" onclick="togglePopup('usagePopup7')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup7">Usage of <span class="code-font"><span class="ACME-function-syntax">sqrt48</span></span>:<br/>Chapter 23: Ellipse - <a href="S-s23.html#SP7">&#167;7</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $befe</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #0                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtResult0</span></a><span class="ACME-plain-syntax">                                    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtResult1</span></a><span class="ACME-plain-syntax">                                    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtResult2</span></a><span class="ACME-plain-syntax">                                    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtRemainder0</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtRemainder1</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtRemainder2</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtRemainder3</span></a><span class="ACME-plain-syntax">                                 </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDX</span><span class="ACME-plain-syntax"> #24                                             </span><span class="ACME-comment-syntax">loop counter</span>
<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">sqrt_loop</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $bf17</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Shift number into remainder</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ASL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtNumber0</span></a><span class="ACME-plain-syntax">                                    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtNumber1</span></a><span class="ACME-plain-syntax">                                    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtNumber2</span></a><span class="ACME-plain-syntax">                                    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtNumber3</span></a><span class="ACME-plain-syntax">                                    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtNumber4</span></a><span class="ACME-plain-syntax">                                    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtNumber5</span></a><span class="ACME-plain-syntax">                                    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtRemainder0</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtRemainder1</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtRemainder2</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtRemainder3</span></a><span class="ACME-plain-syntax">                                 </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Shift number into remainder</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ASL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtNumber0</span></a><span class="ACME-plain-syntax">                                    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtNumber1</span></a><span class="ACME-plain-syntax">                                    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtNumber2</span></a><span class="ACME-plain-syntax">                                    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtNumber3</span></a><span class="ACME-plain-syntax">                                    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtNumber4</span></a><span class="ACME-plain-syntax">                                    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtNumber5</span></a><span class="ACME-plain-syntax">                                    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtRemainder0</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtRemainder1</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtRemainder2</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtRemainder3</span></a><span class="ACME-plain-syntax">                                 </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">temp = root*2</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtResult0</span></a><span class="ACME-plain-syntax">                                    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ASL</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtTemp0</span></a><span class="ACME-plain-syntax">                                      </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtResult1</span></a><span class="ACME-plain-syntax">                                    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtTemp1</span></a><span class="ACME-plain-syntax">                                      </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtResult2</span></a><span class="ACME-plain-syntax">                                    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtTemp2</span></a><span class="ACME-plain-syntax">                                      </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> #0                                              </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtTemp3</span></a><span class="ACME-plain-syntax">                                      </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">temp = temp*2 +1</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEC</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtTemp0</span></a><span class="ACME-plain-syntax">                                      </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtTemp1</span></a><span class="ACME-plain-syntax">                                      </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtTemp2</span></a><span class="ACME-plain-syntax">                                      </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtTemp3</span></a><span class="ACME-plain-syntax">                                      </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Which is bigger, temp or remainder?</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SEC</span><span class="ACME-plain-syntax">                                                 </span><span class="ACME-comment-syntax">temp = remainder - temp</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtRemainder0</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SBC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtTemp0</span></a><span class="ACME-plain-syntax">                                      </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtTemp0</span></a><span class="ACME-plain-syntax">                                      </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtRemainder1</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SBC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtTemp1</span></a><span class="ACME-plain-syntax">                                      </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtTemp1</span></a><span class="ACME-plain-syntax">                                      </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtRemainder2</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SBC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtTemp2</span></a><span class="ACME-plain-syntax">                                      </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtTemp2</span></a><span class="ACME-plain-syntax">                                      </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtRemainder3</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">SBC</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtTemp3</span></a><span class="ACME-plain-syntax">                                      </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtTemp3</span></a><span class="ACME-plain-syntax">                                      </span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">If temp &gt; remainder then branch</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BCC</span><span class="ACME-plain-syntax"> .</span><a href="S-s24.html#SP7" class="function-link"><span class="ACME-function-syntax">sqrt_next</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">if (carry clear) then branch</span>
<span class="ACME-plain-syntax">                                                        </span><span class="ACME-comment-syntax">(forward)</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">remainder = temp</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtRemainder3</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtTemp2</span></a><span class="ACME-plain-syntax">                                      </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtRemainder2</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtTemp1</span></a><span class="ACME-plain-syntax">                                      </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtRemainder1</span></a><span class="ACME-plain-syntax">                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">LDA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtTemp0</span></a><span class="ACME-plain-syntax">                                      </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">STA</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtRemainder0</span></a><span class="ACME-plain-syntax">                                 </span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">sqrt_next</span><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $bfb7</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">root = root * 2 + carry</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtResult0</span></a><span class="ACME-plain-syntax">                                    </span><span class="ACME-comment-syntax">shift result left and add carry</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtResult1</span></a><span class="ACME-plain-syntax">                                    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">ROL</span><span class="ACME-plain-syntax"> .</span><a href="S-s3.html#SP6" class="function-link"><span class="ACME-function-syntax">sqrtResult2</span></a><span class="ACME-plain-syntax">                                    </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">DEX</span><span class="ACME-plain-syntax">                                                 </span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">BEQ</span><span class="ACME-plain-syntax"> </span><span class="ACME-identifier-syntax">+</span><span class="ACME-plain-syntax">                                               </span><span class="ACME-comment-syntax">if (done 24 times) then branch</span>

<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">JMP</span><span class="ACME-plain-syntax"> .</span><a href="S-s24.html#SP7" class="function-link"><span class="ACME-function-syntax">sqrt_loop</span></a><span class="ACME-plain-syntax">                                      </span><span class="ACME-comment-syntax">loop back</span>

<span class="ACME-identifier-syntax">+</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-reserved-syntax">RTS</span><span class="ACME-plain-syntax">                                                 </span>

<span class="ACME-element-syntax">!if</span><span class="ACME-plain-syntax"> </span><span class="ACME-reserved-syntax">MACHINE</span><span class="ACME-plain-syntax"> = </span><span class="ACME-reserved-syntax">ELECTRON</span><span class="ACME-plain-syntax"> {</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">Make it relatively obvious this isn't an original 1980s Acorn version for the Electron.</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!text</span><span class="ACME-plain-syntax"> </span><span class="ACME-string-syntax">"Steve 2020"</span>
<span class="ACME-plain-syntax">}</span>

<span class="ACME-plain-syntax">.</span><span class="ACME-function-syntax">unused</span><button class="popup" onclick="togglePopup('usagePopup8')"><span class="ACME-comment-syntax">?</span><span class="popuptext" id="usagePopup8">Usage of <span class="code-font"><span class="ACME-function-syntax">unused</span></span>:<br/>Chapter 4: ROM header and service entry routines - <a href="S-s4.html#SP1">&#167;1</a>, <a href="S-s4.html#SP4">&#167;4</a><br/>Chapter 11: Shared PLOT subroutines and tables - <a href="S-s11.html#SP8">&#167;8</a></span></button><span class="ACME-plain-syntax"> </span><span class="ACME-comment-syntax">= $bfc7</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-comment-syntax">skip to $bfdb, filling with zeros</span>
<span class="ACME-plain-syntax">    </span><span class="ACME-element-syntax">!align</span><span class="ACME-plain-syntax"> </span><span class="ACME-constant-syntax">$ffff</span><span class="ACME-plain-syntax">, </span><span class="ACME-constant-syntax">$bfdb</span><span class="ACME-plain-syntax">, </span><span class="ACME-constant-syntax">0</span>
</pre>
<nav role="progress"><div class="progresscontainer">
    <ul class="progressbar"><li class="progressprev"><a href="S-s23.html">&#10094;</a></li><li class="progresssection"><a href="S-s1.html">1</a></li><li class="progresssection"><a href="S-s2.html">2</a></li><li class="progresssection"><a href="S-s3.html">3</a></li><li class="progresssection"><a href="S-s4.html">4</a></li><li class="progresssection"><a href="S-s5.html">5</a></li><li class="progresssection"><a href="S-s6.html">6</a></li><li class="progresssection"><a href="S-s7.html">7</a></li><li class="progresssection"><a href="S-s8.html">8</a></li><li class="progresssection"><a href="S-s9.html">9</a></li><li class="progresssection"><a href="S-s10.html">10</a></li><li class="progresssection"><a href="S-s11.html">11</a></li><li class="progresssection"><a href="S-s12.html">12</a></li><li class="progresssection"><a href="S-s13.html">13</a></li><li class="progresssection"><a href="S-s14.html">14</a></li><li class="progresssection"><a href="S-s15.html">15</a></li><li class="progresssection"><a href="S-s16.html">16</a></li><li class="progresssection"><a href="S-s17.html">17</a></li><li class="progresssection"><a href="S-s18.html">18</a></li><li class="progresssection"><a href="S-s19.html">19</a></li><li class="progresssection"><a href="S-s20.html">20</a></li><li class="progresssection"><a href="S-s21.html">21</a></li><li class="progresssection"><a href="S-s22.html">22</a></li><li class="progresssection"><a href="S-s23.html">23</a></li><li class="progresscurrent">24</li><li class="progresssection"><a href="S-s25.html">25</a></li><li class="progressnext"><a href="S-s25.html">&#10095;</a></li></ul></div>
</nav><!--End of weave-->

		</main>
	</body>
</html>

